
<!DOCTYPE html>
<html>
    <head>
           


           
    </head>
<body>
    <h1>My First Google Map</h1>
    <div id="googleMap" style="width:50%;height:400px;"></div>
    <script>
function myMap() {
var mapProp= {
    center: new google.maps.LatLng(6.8211, 80.0409),
    zoom:15,
};



var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
var myCenter = new google.maps.LatLng(6.8211, 80.0409);
var marker = new google.maps.Marker({
    position: myCenter,
    icon: 'https://firebasestorage.googleapis.com/v0/b/eventslk-998f1.appspot.com/o/favicon.ico?alt=media&token=813ce954-74da-4011-9294-543b6b7e56a8'
});

marker.setMap(map);

google.maps.event.addListener(map, 'click', function (event) {
    placeMarker(map, event.latLng);
});




var data = {
  sender: null,
  timestamp: null,
  lat: null,
  lng: null,
  
};

       

     
    

  map.addListener('click', function(e) {
          data.lat = e.latLng.lat();
          data.lng = e.latLng.lng();
         // data.timestamp = firebase.database.ServerValue.timestamp;
         var sessionsRef = firebase.database().ref("sessions");
        sessionsRef.push({
        startedAt: firebase.database.ServerValue.TIMESTAMP,
        lat : data.lat,
        lng : data.lng,
            });
         // addToFirebase(data);

        });


   /*     function getTimestamp(addClick) {
        // Reference to location for saving the last click time.
        var ref = firebase.child('last_message/' + data.sender);

        ref.onDisconnect().remove();  // Delete reference from firebase on disconnect.

        // Set value to timestamp.
        ref.set(Firebase.ServerValue.TIMESTAMP, function(err) {
          if (err) {  // Write to last message was unsuccessful.
            console.log(err);
          } else {  // Write to last message was successful.
            ref.once('value', function(snap) {
              addClick(snap.val());  // Add click with same timestamp.
            }, function(err) {
              console.warn(err);
            });
          }
        });
      }*/




     /*   function addToFirebase(data) {
       
            firebase.database().ref('c2').set({
              //  sessionsRef,
                lat : data.lat,
                lng : data.lng,

  });
        }

*/

function placeMarker(map, location) {
    var marker = new google.maps.Marker({
        position: location,
        map: map
    });
    var infowindow = new google.maps.InfoWindow({
        content: 'Latitude: ' + location.lat() +
        '<br>Longitude: ' + location.lng()
    });
    infowindow.open(map, marker);
}


var lat = marker.getPosition().lat();
var lng = marker.getPosition().lng();







}

function gotdata(data){
 //   console.log(data.val());
    var clicks = data.val();
    var keys = Object.keys(clicks);
    console.log(keys);
}


function errdata(err){
    console.log("Error");
    console.log(err);
}

</script>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>

<script>
       //var firebase = new Firebase("https://eventslk-998f1.firebaseio.com/");
           // Initialize Firebase
           var config = {
             apiKey: "AIzaSyDdi4OfjbR8ouKauj8KB4WnIItCA-LSHOM",
             authDomain: "eventslk-998f1.firebaseapp.com",
             databaseURL: "https://eventslk-998f1.firebaseio.com",
             projectId: "eventslk-998f1",
             storageBucket: "eventslk-998f1.appspot.com",
             messagingSenderId: "925105002297"
           };
         firebase.initializeApp(config);
          var database = firebase.database();
           var ref = database.ref('sessions');
           ref.on('value',gotdata, errdata);
            </script>




    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBURV6Nz_7XJArcFeXNQxZrGhzDAHAALN0&callback=myMap"></script>
</body>
</html>